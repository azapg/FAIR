---
title: Database Migrations
description: How to create and apply Alembic migrations for FAIR Platform
---

This guide documents the **official migration workflow** for the backend database. Follow it to avoid schema drift and keep local/dev databases consistent.

## Prerequisites

- Use the project’s Python environment (`uv`)
- Run Alembic from the repo root
- Use the backend config at `src/fair_platform/backend/alembic.ini`

## DATABASE_URL (deterministic DB selection)

If `DATABASE_URL` is set, Alembic will use it. If not, it defaults to local SQLite.

Examples:

```/dev/null/commands.sh#L1-3
# Use a specific local SQLite file
DATABASE_URL=sqlite:///fair.db uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head

# Use PostgreSQL
DATABASE_URL=postgresql://user:pass@localhost:5432/fair uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head
```

This makes the migration target explicit and avoids surprises when switching environments.

## Quick Start

Create a new migration after changing models:

```/dev/null/commands.sh#L1-2
cd C:\Users\allan\Documents\fair-platform
uv run python -m alembic -c src/fair_platform/backend/alembic.ini revision --autogenerate -m "your message"
```

Apply all migrations:

```/dev/null/commands.sh#L1-2
cd C:\Users\allan\Documents\fair-platform
uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head
```

## Standard Workflow

1. **Edit SQLAlchemy models** in `src/fair_platform/backend/data/models/`
2. **Generate a migration** using `--autogenerate`
3. **Review the generated migration** before applying
4. **Apply the migration**

Example:

```/dev/null/commands.sh#L1-6
cd C:\Users\allan\Documents\fair-platform
uv run python -m alembic -c src/fair_platform/backend/alembic.ini revision --autogenerate -m "add submission events"
# Inspect the migration file under src/fair_platform/backend/alembic/versions/
uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head
```

## Resetting the Dev Database (SQLite)

If you are in a **local dev environment** and you want a clean database:

```/dev/null/commands.sh#L1-3
cd C:\Users\allan\Documents\fair-platform
del fair.db
uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head
```

This is destructive. Only do this for local dev data.

## When Alembic Fails to Generate

### Missing script template (`script.py.mako`)
If you see an error about a missing script template, make sure this file exists:

`src/fair_platform/backend/alembic/script.py.mako`

### Import errors (module not found)
Always run Alembic with `uv run` so it uses the project environment.

```/dev/null/commands.sh#L1-2
cd C:\Users\allan\Documents\fair-platform
uv run python -m alembic -c src/fair_platform/backend/alembic.ini upgrade head
```

## Best Practices

- **Never edit the database directly** unless it’s a throwaway local DB.
- **Never delete migration history** on shared branches.
- **Always review autogenerated migrations** for correctness.
- **Keep migrations small and focused.**

## Troubleshooting

### "table already exists"
This means you have an existing database without Alembic history. Either:

- Reset the dev DB (safe for local), or
- Stamp the current DB as the head revision:

```/dev/null/commands.sh#L1-2
cd C:\Users\allan\Documents\fair-platform
uv run python -m alembic -c src/fair_platform/backend/alembic.ini stamp head
```
